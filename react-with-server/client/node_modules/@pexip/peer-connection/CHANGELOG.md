# Changelog

## 17.10.1

## 17.10.0

### Minor Changes

- 2ba83f6: Improve ICE Candidate Error handling and logging

### Patch Changes

- 869dbf4: Adds `shouldSyncMedia` prop to `setLocalStream`. Default is `true`.
- d66158c: Throttles `onConnectionStateChange` signal when the state is
  `disconnected` or `failed` until we try restarting ICE.
  - @pexip/signal@16.7.0

## 17.9.0

### Minor Changes

- 4a1908a: Use tsc to build packages
- fec1c90: Prettier

### Patch Changes

- Updated dependencies [4a1908a]
- Updated dependencies [ec134d1]
  - @pexip/signal@16.7.0

## 17.8.0

### Minor Changes

- 51fd12ad74: Fix change direction in-between negotiations issue
- f40a24ac: Expose `addConfig`
- 7b29d953: Update babel/traverse related deps

### Patch Changes

- 8ef596b9: Make early return for port 0 more strict and apply only for the
  answer
  - @pexip/signal@16.6.0

## 17.7.0

### Minor Changes

- 26878b60: Add `sendEncodings` and related features to `TransceiverConfig`

  - Allow changing `sendEncodings` and apply the changes to related
    `Transceiver`

### Patch Changes

- df5c5eaece: Fix issue when there was a chance that `max-width` and
  `max-height` were added twice to the simulcast
- 4ea55a5205: Prettier and linting for new prettier version.
  - @pexip/signal@16.6.0

## 17.6.0

### Minor Changes

- e62c6ec: Defer negotiation instead of ignoring it
- 6d5ea24: No Syncing Media when connectionState is closed
- bcfa59f: Add configs to get all media configs

### Patch Changes

- Updated dependencies [bcfa59f]
  - @pexip/signal@16.6.0

## 17.5.0

### Minor Changes

- 9b898e62: Add relative direction & fix setLocalStream
- 5655f63e: Extend `sendEncodings` type to allow passing `maxHeight` and
  `maxWidth`. Which are injected to the sdp simulcast lines via `SdpManager`.
- 6d9f265e: # Move Data Channel creation into MediaConfig

  - Add `polite` option to PeerConnectionOptions

    Add `polite` option, and remove related logic in the package as it should be
    done via the consumer

  - Remove lazy negotiation related logic

    There is no way to implement lazy negotiation because of this
    [Chromium `max-bundle` issue](https://bugs.chromium.org/p/webrtc/issues/detail?id=13274)
    bug

  - Move Data Channel creation into MediaConfig

    With the changes, creating a Data Channel is the same how we create
    Transceivers by declaring the init accordingly to `mediaInits` to ensure the
    Data Channel and Transceivers are created in order.

  - Fix never-ending negotiation

    When Alice and Bob are negotiating what stands for a, and they cannot agree
    each other, we should stop this negotiation.

  - Fix a race issue when we sync transceiver after an answer

  - Fix ICE candidate order/buffering issue

    fixes https://gitlab.com/pexip/zoo/-/issues/3906

  related https://github.com/pexip/mcu/issues/34115 related
  https://gitlab.com/pexip/zoo/-/issues/4163

### Patch Changes

- c00c3bf1: Improve logic of syncing transceivers. In particular fixes the issue
  when we call `setStream` which triggers `onOfferRequired` while in
  `have-local-offer` state which previously didn't trigger
  `onnegotiationneeded`. Similar improvements were made to the syncing of the
  data channels.
- 718e62b4: Fixes the issue when we were striping all the codecs meaning there
  was no payload in the video m line which was causing sdp validation to fail.
  This scenario can happen when mcu rejects the line (eg. when vmr is only
  audio-only). In this case we could receive m line with port 0 and no
  underlying rtp, rtpmap, and fmtp lines. Now we make sure that if we can't
  identify payloads based on the underlying lines, we keep the original
  payloads.

## 17.4.0

### Minor Changes

- 4298b039: Add handling of unidirectional connection

## 17.3.0

### Minor Changes

- bee58fb: Fix infinite negotiation when non-polite peer presenting

  fixes https://gitlab.com/pexip/zoo/-/issues/3933

- 8372f12: Use negotiation insteadof restartICE for bandwidth changes

### Patch Changes

- @pexip/signal@16.5.0

## 17.2.1

## 17.2.0

### Minor Changes

- 0f95c333: Refactor to standardize error logging

## 17.1.0

### Minor Changes

- 85b75b1: Ensure transceiver direction is always in-sync
- 13d77ec: Rename escalateDirection to changeDirection and support
  RTCRtpTransceiverDirection as a intendedDirection

## 17.0.0

### Major Changes

- e6ef1f2: Implement Escalation and Perfect Negotiation

  - Implement Transceiver Escalation https://gitlab.com/pexip/zoo/-/issues/3482
  - Implement Perfect Negotiation
    https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Perfect_negotiation
  - Implement Lazy Transceiver to tackle Direct Media flow
  - Implement Transceiver warmup to start negotiation ASAP

### Minor Changes

- 6225612: Remove @pexip/logger dependency

### Patch Changes

- Updated dependencies [6225612]
  - @pexip/signal@16.5.0

## 16.3.2

### Patch Changes

- Updated dependencies [6534b17]
  - @pexip/signal@16.4.0

## 16.3.1

## 16.3.0

### Patch Changes

- @pexip/logger@16.3.0
- @pexip/signal@16.3.0

## 16.2.0

### Patch Changes

- @pexip/logger@16.2.0
- @pexip/signal@16.2.0

## 16.1.0

### Patch Changes

- @pexip/logger@16.1.0
- @pexip/signal@16.1.0

## 16.0.0

### Patch Changes

- @pexip/logger@16.0.0
- @pexip/signal@16.0.0

## 15.0.0

### Patch Changes

- @pexip/logger@15.0.0
- @pexip/signal@15.0.0

## 14.1.0

### Patch Changes

- @pexip/logger@14.1.0
- @pexip/signal@14.1.0

## 14.0.0

### Patch Changes

- @pexip/logger@14.0.0
- @pexip/signal@14.0.0

## 13.2.0

### Minor Changes

- bd46408e: support webrtc stats for presentation

### Patch Changes

- @pexip/logger@13.2.0
- @pexip/signal@13.2.0

## 13.1.0

### Patch Changes

- @pexip/logger@13.1.0
- @pexip/signal@13.1.0

## 13.0.0

### Minor Changes

- c78c83bb: Remove unused createPresentationPeerConnection as we moved to
  bundle.

### Patch Changes

- 759c5b6a: Expose all webrtc stats via pexDebug.stats
  - @pexip/logger@13.0.0
  - @pexip/signal@13.0.0

## 12.0.0

### Patch Changes

- 518b20d3: Fix packetizationMode flag to work when only h264 is enabled. FF
  bug.
- Updated dependencies [52cd2cdb]
  - @pexip/signal@12.0.0
  - @pexip/logger@12.0.0

## 11.0.0

### Patch Changes

- @pexip/logger@11.0.0
- @pexip/signal@11.0.0

## 10.1.0

### Minor Changes

- 0981ef13: Emit `onSecureCheckCode`on receiving/creating an SDP offer/answer

### Patch Changes

- @pexip/logger@10.1.0
- @pexip/signal@10.1.0

## 10.0.0

### Patch Changes

- @pexip/logger@10.0.0
- @pexip/signal@10.0.0

## 9.0.0

### Patch Changes

- @pexip/logger@9.0.0
- @pexip/signal@9.0.0

## 8.0.0

### Patch Changes

- @pexip/logger@8.0.0
- @pexip/signal@8.0.0

## 7.0.0

### Patch Changes

- Updated dependencies [efc7d2a8]
  - @pexip/logger@7.0.0
  - @pexip/signal@7.0.0

## 6.0.0

### Patch Changes

- @pexip/logger@6.0.0
- @pexip/signal@6.0.0

## 5.0.0

### Patch Changes

- @pexip/logger@5.0.0
- @pexip/signal@5.0.0

## 4.0.0

### Patch Changes

- @pexip/logger@4.0.0
- @pexip/signal@4.0.0

## 2.0.1

### Patch Changes

- Updated dependencies [46b70ba43]
  - @pexip/logger@2.1.0
  - @pexip/signal@2.0.1

## 2.0.0

### Patch Changes

- Updated dependencies [29741a2d4]
- Updated dependencies [958250434]
- Updated dependencies [89ef2b1aa]
- Updated dependencies [04752bc9d]
- Updated dependencies [29741a2d4]
  - @pexip/logger@2.0.0
  - @pexip/signal@2.0.0

## 1.5.0

### Patch Changes

- 7d82466d3: Decouple ICE restart and trickling logic

## 1.4.0

### Minor Changes

- 5c9120efd: Track changes using changesets

### Patch Changes

- Updated dependencies [5c9120efd]
  - @pexip/logger@1.4.0
  - @pexip/signal@1.4.0

## [0.3.3] - 2021-03-03

### Changed

- Only call `restartIce` when the `bandwidth` is actually changed

## [0.3.2] - 2021-02-25

### Changed

- Clears `connectionState` timeout when attempting `IceRestart`
  [#3641](https://github.com/pexip/aquila-research/pull/3641)

## [0.3.1] - 2021-02-09

### Changed

- Add `TIAS` line only for outgoing media lines

## [0.3.0] - 2021-02-09

### Added

- Add `TIAS` lines for bandwidth limit for FF, add bandwidth lines for sdp
  answer from the server as well

## [0.2.4] - 2021-01-13

### Fixed

- Resolve `SDP` from `pendingLocalDescription` [#2950]

## [0.2.3] - 2020-12-01

### Fixed

- Try to restart ice when it goes to `disconnected` [#2766]

## [0.2.2] - 2020-12-01

### Fixed

- Log when `setLocalDescription` is actually run

## [0.2.1] - 2020-11-30

### Changed

- Add a `createdAt` reference to `PeerConnection` for logging so that it is
  easier to differentiate instances

### Fixed

- 'NS_ERROR_UNEXPECTED' issue for Firefox

[#2595]

## [0.2.0] - 2020-11-27

### Added

- Use trickle ICE when `onIceCandidate` signal is provided

### Changed

- Better logging
- Move `onRemoteStream` signal back to `PeerConnectionSignals` from
  `MainPeerConnectionSignals` to leave the decision to be made from the
  application, not the library
- **BREAKING** Rename `createPCRequiredSignals` to `createPCSignals` to accept
  `{scope, more}` options to add more signals apart from the required ones. e.g.

  ```typescript
  // Generate 'onRemoteStream' and 'onIceCandidate' signals in addition to `PCRequiredSignals`
  const signals = createPCSignals({
    more = ['onRemoteStream', 'onIceCandidate'],
  });
  ```

Related PR: #2538

### Fixed

- `onOfferRequired` signal issue
- Object spread and accessors issues
- Double cleanup when close the connection issues

## [0.1.1] - 2020-11-19

### Changed

- Remove the "Signal" part of the key for generated signals.
- Move `onRemoteStream` signal to `MainPeerConnectionSignals`.

[#2376]

## [0.1.0] - 2020-11-18

### Added

- Initial version release
